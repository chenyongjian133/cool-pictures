<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="css/style.css" media="screen">

</head>
<body>

<div id="wall" class="wall">

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>

  <div class="cube">
    <div class="side front"></div>
    <div class="side right"></div>
    <div class="side back"></div>
    <div class="side left"></div>
    <div class="side top"></div>
    <div class="side bottom"></div>
  </div>
  <div class="nav">
    <div id="prev" class="button prev"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 10 28"><path d="M0.703 15q0-0.203 0.156-0.359l7.281-7.281q0.156-0.156 0.359-0.156t0.359 0.156l0.781 0.781q0.156 0.156 0.156 0.359t-0.156 0.359l-6.141 6.141 6.141 6.141q0.156 0.156 0.156 0.359t-0.156 0.359l-0.781 0.781q-0.156 0.156-0.359 0.156t-0.359-0.156l-7.281-7.281q-0.156-0.156-0.156-0.359z" fill="#000000"></path></svg></div>
    <div id="next" class="button next"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 10 28"><path d="M0.203 21.5q0-0.203 0.156-0.359l6.141-6.141-6.141-6.141q-0.156-0.156-0.156-0.359t0.156-0.359l0.781-0.781q0.156-0.156 0.359-0.156t0.359 0.156l7.281 7.281q0.156 0.156 0.156 0.359t-0.156 0.359l-7.281 7.281q-0.156 0.156-0.359 0.156t-0.359-0.156l-0.781-0.781q-0.156-0.156-0.156-0.359z" fill="#000000"></path></svg></div>
  </div>
</div>
<script type="text/javascript">
  (function(win, doc) {
    function byId(id) {
      return doc.getElementById(id);
    }
    function qAll(sel) {
      return doc.querySelectorAll(sel);
    }
    function each(arr, callback) {
      [].forEach.call(arr, callback);
    }
    //取图片路径
    function imageUrl(n) {
      var url='url(img/minion_'+n+'.jpg)'
      return url
    }
    //预加载图片
    function preloadImages(images) {
      var div = doc.createElement('div');
      var bg = '';
      for (var i = 1; i <= images; i++) {
        bg += imageUrl(i);
        bg = i < images ? bg + ',' : bg;
      }
//      console.log(bg);
      //url(img/minion_1.jpg),url(img/minion_2.jpg),url(img/minion_3.jpg),url(img/minion_4.jpg),url(img/minion_5.jpg),url(img/minion_6.jpg),url(img/minion_7.jpg)
      div.style.backgroundImage = bg;
      div.style.opacity = '0';
      div.style.position = 'absolute';
      div.style.height = '0';
      div.style.width = '0';
      div.style.top = '0';
      div.style.left = '0';
      document.body.appendChild(div);
      console.log(div,div.style.backgroundImage);
    }
    //覆盖层
    function overlay() {
      img = doc.createElement('div');
      img.style.backgroundImage = imageUrl(slide);
      img.classList.add('overlay');
      byId('wall').appendChild(img);
    }

    function updateSlides(elm, add) {
      var current = slide + add;
      //无缝轮播
      current = current < 1 ? slides : current;
      current = current > slides ? 1 : current;
//      遍历所有的前置元素,背景图为当前号码
      each(elm.querySelectorAll('.front'), function(el, i) {
        el.style.backgroundImage = imageUrl(current);
      });
//      遍历所有的左右上下元素,
      each(elm.querySelectorAll('.bottom, .right, .top, .left'), function(el, i) {
        var nextSlide = current > slides - 1 ? 1 : current + 1;
        if (add > 0) {
          nextSlide = current < 2 ? slides : current - 1;
        }
        el.style.backgroundImage = imageUrl(nextSlide);
      });
    }

    var timer = [],slide = 1,slides = 7;
    function stop() {
      each(timer, function(el, i) {
        clearTimeout(timer[i]);
      });
    }
    byId('next').addEventListener('click', function() {
      stop();
      next(-1);
    });
    byId('prev').addEventListener('click', function() {
      stop();
      next(1);
    });
    var img, block = false;
    function next(n) {
      if (block) { return false}
      block = true;
      //点击下一张,图片号码++,
      if (n < 0) {
        slide = slide > slides - 1 ? 0 : slide;
        slide++;
      } else if (n > 0) {
        slide = slide < 2 ? slides + 1 : slide;
        slide--;
      }
      setSides(n);
    }
    //图片隐藏,取所有的wall元素,遍历
    var dirs = ['up', 'right', 'down', 'left'];
    function setSides(n) {
      img.style.opacity = '0';
      each(qAll('.cube'), function(el, i) {
        updateSlides(el, n);
        //0-3
        var rand = parseInt((Math.random() * 4), 10);
        var dir = dirs[rand];
//        wall包裹层增加sliding,或dirs中的一个class
        el.classList.add('sliding');
        el.classList.add(dir);
      });
    }

    each(qAll('.cube'), function(el, i) {
      el.addEventListener('animationend', function() {
        el.className = 'cube';
        img.style.backgroundImage = imageUrl(slide);
        updateSlides(el, 0);
        if (i == qAll('.cube').length - 1) {
          block = false;
          img.style.opacity = '1';
        }
      });
    });

    function delaySlide(n, int) {
      timer[n] = setTimeout(function() {
        next(-1);
      }, int * (n + 1));
    }

    function play(n, int) {
      for (var i = 0; i < n; i++) {
        delaySlide(i, int);
      }
    }

    preloadImages(slides);
    overlay();
    play(slides, 3000);

  })(window, document);


  //    function image(n) {
  //      var url = 'img/minion_';
  //      url += n;
  //      url += '.jpg';
  //      return url;
  //    }
  //
  //    function imageUrl(n) {
  //      var url = 'url(';
  //      url += image(n);
  //      url += ')';
  //      return url;
  //    }
</script>
</body>
</html>